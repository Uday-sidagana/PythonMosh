{% extends 'base.html'  %}
{% block title %}INDEX{% endblock %}
{% block content %}
<h1>INDEX PAGE</h1>
<ul>
    {% for person in people %}
    <li>
        {{person}} <button onclick="deletePerson({{ person.pid }})">Delete</button>

    </li>
    <li>{{ person.name }} (ID: {{ person.pid }})</li>

    {% endfor %}
</ul>

<h3>New Person</h3>
    <form action="{{url_for('index')}}" method="POST">
        <input type="text" placeholder="NAME" name="name"><br>
        <input type="number" placeholder="AGE" name="age" ><br>
        <input type="text" placeholder="JOB" name="job"><br>
        <input type="submit" value="Add New Person">
    </form>

{% endblock %}

<script type="text/javascript">
    function deletePerson(pid){
        // fetch and method is the primary code
        fetch('{{ url_for("delete", pid=pid)}}'+ pid, {
            method: 'DELETE'
        }).then(response =>{
            if(response.ok){
                window.location.reload();
            }
            else{
                console.error('FAILED to DLEETE', pid);
            }
        })

        .catch(error => {
            console.error('error while fetching', error);
        });
    };
    
</script>